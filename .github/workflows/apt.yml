name: APT REPO in Pages
on:
  push:
    branches:
      - master
      - main

env:
  DIST: 'pages'
  DEBUG: 'false'
  PUB_KEY: 'pub.key'
  PRIV_KEY: 'priv.key'
  KEY_ID: '908144B521689A950CCB5E801347937B188623BC'
  CONF_FILE: aptly.conf
  URL_REPO: 'https://sirherobrine23.github.io/Apt-Pages'
  pass: "${{ secrets.PASSWORD }}"
  
jobs:
  reprepro:
    runs-on: ubuntu-18.04
    container: sirherobrine23/apt_pages:latest
    if: github.event.repository.owner.id == github.event.sender.id
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.2

      - name: tmate - ssh
        if: env.DEBUG == 'true' || contains(github.event.action, 'erro no')
        uses: Sirherobrine23/ssh-connect-for-apt@main

      - name: Reprepro to build
        run: |
          publish

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3.7.0-8
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: /public/
